(this.webpackJsonpsynthsites=this.webpackJsonpsynthsites||[]).push([[0],{59:function(e,t,n){e.exports=n(71)},64:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(11),o=n.n(r),i=(n(64),n(7)),s=n(108),l=n(106),u=n(109),h=n(104),d=n(105),b=n(103),f=n(50),p=n.n(f),m=n(51),O=n(100),g=Object(a.createContext)(),j=Object(m.a)(),v=Object(O.a)({"c-app--full-height":{height:"calc(100vh - 16px)","max-height":"calc(100vh - 16px)"},"c-story-panel--full-height":{"max-height":"calc(85vh - 64px)",height:"calc(85vh - 64px)"},"c-control-panel":{},"c-fileio-import-button":{background:j.palette.primary.main,color:j.palette.primary.contrastText,margin:j.spacing(1)},"c-fileio-export-button":{background:j.palette.primary.main,color:j.palette.primary.contrastText,margin:j.spacing(1)},"c-story-panel__paper":{padding:j.spacing(1),"user-select":"contain"},"c-story-panel__container":{overflow:"auto",height:"100%"},"c-controls--fill-width":{width:"100%"},"c-controls__textfield":{"margin-top":j.spacing(2),"margin-bottom":j.spacing(2)},"c-hotkey__paper":{padding:j.spacing(1),width:"100%"},"c-labelmodal__container":{position:"absolute",top:"50%",left:"50%",width:"50%",transform:"translate(-50%, -50%)",background:"white",padding:j.spacing(5)},"c-labelmodal__textfield":{width:"100%"},"c-request-hotkey__request":{background:j.palette.secondary.main,color:j.palette.secondary.contrastText,padding:j.spacing(1),"font-weight":"bold"},"c-request-hotkey__description":{padding:j.spacing(1)},"c-request-hotkey__paper":{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",padding:j.spacing(2)},"c-terminal":{"padding-top":j.spacing(2),"padding-bottom":j.spacing(2),"padding-left":j.spacing(1),"padding-right":j.spacing(1),"max-height":"calc(15vh - 32px)",height:"calc(15vh - 32px)",overflow:"auto"},"c-terminal__history":{"font-family":"'Inconsolata', monospace","line-height":1}}),y=Object(a.createContext)(),E=function(){return Object(a.useContext)(y)},k=n(2),w=n(19),x=n(15),C=n(6),_=n(13),S=n(110),N=function(e){var t=e.onComplete,n=Object(k.a)(e,["onComplete"]),r=Object(a.useState)(""),o=Object(i.a)(r,2),s=o[0],l=o[1];return c.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t(s),l("")}},c.a.createElement(S.a,Object.assign({},n,{value:s,onChange:function(e){return l(e.target.value)}})))},L=n(72),R=n(113),A=new Set(["Shift","Control","Alt","CapsLock"]),P=function(e,t){0!==e.length&&(t.preventDefault(),e.forEach((function(e){return e(t.key)})))},H=function(){function e(){var t=this;Object(w.a)(this,e),Object.defineProperty(this,T,{writable:!0,value:{}}),this.CaptureShortcut=function(e){return c.a.createElement(q,Object.assign({hotkeys:t},e))},this.Hotkey=function(e){return c.a.createElement(M,Object.assign({hotkeys:t},e))},this.CreateNewHotkey=function(e){return c.a.createElement(I,Object.assign({hotkeys:t},e))}}return Object(x.a)(e,[{key:"useHotkeys",value:function(){var e=this,t=function(t){if(!A.has(t.key))if(Object(C.a)(e,T)[T].all&&0!==Object(C.a)(e,T)[T].all.length){var n=Object(C.a)(e,T)[T].all;P(n,t)}else if("Escape"!==t.key){if("input"!==document.activeElement.tagName.toLowerCase()){var a=Object(C.a)(e,T)[T][t.key]||[];P(a,t)}}else{var c=Object(C.a)(e,T)[T].Escape||[];P(c,t)}};Object(a.useEffect)((function(){return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}}))}},{key:"registerHotkey",value:function(e,t){var n=Object(C.a)(this,T)[T][e];n||(n=[],Object(C.a)(this,T)[T][e]=n),n.push(t)}},{key:"unregisterHotkey",value:function(e,t){Object(C.a)(this,T)[T][e]=Object(C.a)(this,T)[T][e].filter((function(e){return e!==t}))}}]),e}(),T=Object(_.a)("hotkeys"),M=function(e){var t=e.hotkeys,n=e.shortcut,r=e.action,o=e.description,i=Object(k.a)(e,["hotkeys","shortcut","action","description"]),s=Object(a.useContext)(g).classes;return Object(a.useEffect)((function(){return t.registerHotkey(n,r),function(){t.unregisterHotkey(n,r)}})),c.a.createElement(L.a,Object.assign({className:s["c-hotkey__paper"]},i),"".concat(n," \ud83e\udc16 ").concat(o))},q=function(e){var t=e.hotkeys,n=e.description,r=e.onCapture,o=Object(k.a)(e,["hotkeys","description","onCapture"]),i=Object(a.useContext)(g).classes;return Object(a.useEffect)((function(){var e=function(e){r(e,n)};return t.registerHotkey("all",e),function(){t.unregisterHotkey("all",e)}})),c.a.createElement(b.a,Object.assign({container:!0,alignItems:"center",justify:"center",className:i["c-request-hotkey__paper"]},o),c.a.createElement(h.a,{display:"inline",className:i["c-request-hotkey__request"]},"Select a hotkey"),c.a.createElement(h.a,{display:"inline",className:i["c-request-hotkey__description"]}," ".concat(n)))},I=function(e){var t=e.hotkeys,n=e.onHotkeyAdded,r=(Object(k.a)(e,["hotkeys","onHotkeyAdded"]),Object(a.useContext)(g).classes),o=Object(a.useState)(),s=Object(i.a)(o,2),l=s[0],u=s[1],h=Object(a.useState)(!1),d=Object(i.a)(h,2),b=d[0],f=d[1];return c.a.createElement("div",null,c.a.createElement(N,{label:"Add hotkey",className:"".concat(r["c-controls--fill-width"]," ").concat(r["c-controls__textfield"]),onComplete:function(e){u(e),f(!0)}}),c.a.createElement(R.a,{open:b},c.a.createElement("div",null,c.a.createElement(q,{hotkeys:t,description:l,onCapture:function(e,t){f(!1),n(e,t)}}),"}")))},U=n(14),V=n(111),B=function(){function e(){var t=this;Object(w.a)(this,e),this.history=[],this.nextId=0,Object.defineProperty(this,F,{writable:!0,value:[]}),this.Component=function(){return c.a.createElement(D,{terminal:t})}}return Object(x.a)(e,[{key:"log",value:function(e){for(var t=this,n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];void 0!==a&&(e="".concat(e," ").concat(a.join(" "))),this.history=[].concat(Object(U.a)(this.history),[c.a.createElement(z,{key:this.nextId++},">",e)]),Object(C.a)(this,F)[F].forEach((function(e){return e(t.history)}))}},{key:"append",value:function(e){var t=this;this.history=[].concat(Object(U.a)(this.history),[c.a.createElement("div",{key:this.nextId++},e)]),Object(C.a)(this,F)[F].forEach((function(e){return e(t.history)}))}},{key:"registerOnUpdate",value:function(e){Object(C.a)(this,F)[F].push(e)}},{key:"unregisterOnUpdate",value:function(e){Object(C.a)(this,F)[F]=Object(C.a)(this,F)[F].filter((function(t){return t!==e}))}}]),e}(),F=Object(_.a)("onUpdateCallbacks"),z=function(e){var t=e.children,n=Object(k.a)(e,["children"]),r=Object(a.useContext)(g).classes;return c.a.createElement(h.a,Object.assign({className:r["c-terminal__history"]},n),t)},D=function(e){var t=e.terminal,n=Object(a.useContext)(g).classes,r=Object(a.useState)([t.history]),o=Object(i.a)(r,2),s=o[0],l=o[1],u=Object(a.createRef)();return Object(a.useEffect)((function(){var e=function(e){l(e)};return t.registerOnUpdate(e),u.current.scrollTop=u.current.scrollHeight,function(){t.unregisterOnUpdate(e)}})),c.a.createElement(V.a,{ref:u,component:"div",className:n["c-terminal"]},c.a.createElement("div",{children:s}))},J=function(){function e(t){Object(w.a)(this,e),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object(C.a)(this,W)[W]=t}return Object(x.a)(e,[{key:"useRange",value:function(){var e=this,t=Object(a.useState)(this.getRange()),n=Object(i.a)(t,2),c=n[0],r=n[1];return Object(a.useEffect)((function(){document.addEventListener("selectionchange",(function(){r(e.getRange())}))})),c}},{key:"setRange",value:function(e){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}},{key:"getRange",value:function(){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0);return Z(t,Object(C.a)(this,W)[W].current)?t:null}}}]),e}(),W=Object(_.a)("containerRef"),Z=function(e,t){if(!e||!t)return!1;var n=e.startContainer,a=e.endContainer;return!!t.contains(n)&&!!t.contains(a)},$=function(e){var t=e.onFileLoaded,n=Object(a.useContext)(g).classes;return c.a.createElement("span",null,c.a.createElement("input",{id:"c-raised-button-file",type:"file",style:{display:"none"},onChange:function(e){var n=new FileReader;n.onload=function(e){return t(e.target.result)},n.readAsText(e.target.files[0])}}),c.a.createElement("label",{htmlFor:"c-raised-button-file"},c.a.createElement(d.a,{variant:"contained",component:"span",className:n["c-fileio-import-button"]},"Load story")))},G=n(112),K=n(107),Q=function(e){var t=e.open,n=e.onClose,r=Object(k.a)(e,["open","onClose"]),o=Object(a.useContext)(g).classes;return c.a.createElement("div",null,c.a.createElement(R.a,{open:t,onClose:n},c.a.createElement("div",{className:o["c-labelmodal__container"]},c.a.createElement(N,Object.assign({autoFocus:!0,className:o["c-labelmodal__textfield"]},r)))))},X="[a-zA-Z][a-zA-Z0-9]*",Y="".concat(X),ee=new RegExp("^\\s*(".concat(X,")(?:\\s*=\\s*").concat('"(?:[^"]*|\\?)"',"|(?:\\s+").concat(Y,"\\s*=\\s*").concat('"(?:[^"]*|\\?)"',")*)\\s*$")),te=new RegExp("(".concat(X,')\\s*=\\s*"(\\?)"'),"g"),ne=function(){function e(t){var n=t.startContainer,a=t.startOffset,c=t.endContainer,r=t.endOffset;Object(w.a)(this,e),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object(C.a)(this,ae)[ae]=n,Object(C.a)(this,ce)[ce]=a,Object(C.a)(this,re)[re]=c,Object(C.a)(this,oe)[oe]=r,Object(C.a)(this,se)[se]=new Range,Object(C.a)(this,se)[se].setStart(c,r),Object(C.a)(this,se)[se].setEnd(c,r),Object(C.a)(this,le)[le]=new Range,Object(C.a)(this,le)[le].setStart(n,a),n===c?Object(C.a)(this,le)[le].setEnd(c,r):Object(C.a)(this,le)[le].setEndAfter(n)}return Object(x.a)(e,[{key:"prepend",value:function(e){Object(C.a)(this,le)[le].insertNode(e)}},{key:"append",value:function(e){Object(C.a)(this,se)[se].insertNode(e)}},{key:"apply",value:function(e){if(e(Object(C.a)(this,le)[le]),Object(C.a)(this,ae)[ae]!==Object(C.a)(this,re)[re])for(var t=Object(C.a)(this,ae)[ae];;)if(t.nextSibling){if(t=t.nextSibling,this.applyToLeaves(e,t))return}else t=t.parentNode}},{key:"applyToLeaf",value:function(e,t){var n=new Range;return n.setStartBefore(t),t!==Object(C.a)(this,re)[re]?(n.setEndAfter(t),e(n),!1):(n.setEnd(Object(C.a)(this,re)[re],Object(C.a)(this,oe)[oe]),e(n),!0)}},{key:"applyToLeaves",value:function(e,t){for(var n=[t];0!==n.length;){var a=n.pop();if(0===a.childNodes.length){if(this.applyToLeaf(e,a))return!0}else for(var c=a.childNodes.length-1;c>=0;c--)n.push(a.childNodes[c])}return!1}}]),e}(),ae=Object(_.a)("startNode"),ce=Object(_.a)("startOffset"),re=Object(_.a)("endNode"),oe=Object(_.a)("endOffset"),ie=Object(_.a)("startingPoint"),se=Object(_.a)("endingPoint"),le=Object(_.a)("startRange"),ue=function(){function e(t,n){Object(w.a)(this,e),this.missingProperties=[],Object.defineProperty(this,he,{writable:!0,value:[]}),this.providedValues=[],Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,be,{writable:!0,value:void 0});var a=function(e){return e.matchAll(te)}(n),c=!0,r=!1,o=void 0;try{for(var i,s=a[Symbol.iterator]();!(c=(i=s.next()).done);c=!0){var l=i.value,u=l[1],h=l.index+l[0].search('"?"')+1;Object(C.a)(this,he)[he].push([u,h]),this.missingProperties.push(u)}}catch(d){r=!0,o=d}finally{try{c||null==s.return||s.return()}finally{if(r)throw o}}Object(C.a)(this,be)[be]=t,Object(C.a)(this,de)[de]=n}return Object(x.a)(e,[{key:"setNextValue",value:function(e){var t=this.providedValues.length,n=Object(i.a)(Object(C.a)(this,he)[he][t],2)[1];this.providedValues.push([e,n])}},{key:"getCompletedLabel",value:function(){for(var e=Object(C.a)(this,de)[de],t="",n=0,a=0;a<this.providedValues.length;a++){var c=Object(i.a)(this.providedValues[a],2),r=c[0],o=c[1];t+=e.substring(n,o)+r,n=o+1}return t+=e.substring(n,e.length),this.completedLabel=t,t}},{key:"injectLabel",value:function(){var e,t=this.getCompletedLabel();if(e=t,!ee.test(e))return!1;var n=function(e){var t=ee.exec(e),n=Object(i.a)(t,2),a=n[0],c=n[1];return["[".concat(a,"]"),"meta"===c?null:"[/".concat(c,"]")]}(t),a=Object(i.a)(n,2),c=a[0],r=a[1];return fe(c,r,Object(C.a)(this,be)[be]),!0}}]),e}(),he=Object(_.a)("propertyOffsets"),de=Object(_.a)("label"),be=Object(_.a)("range"),fe=function(e,t,n){var a=new ne(n),c=document.createElement("span");if(c.setAttribute("data-cookiesynth",e),a.prepend(c),t){var r=document.createElement("span");r.setAttribute("data-cookiesynth",t),a.append(r)}a.apply((function(e){return function(e){var t=document.createElement("span");t.setAttribute("style","background-color: yellow;"),t.setAttribute("data-cookiesynth-style","highlight"),t.setAttribute("class","highlight"),e.surroundContents(t)}(e)}))},pe=function(e){var t=e.onLabel,n=e.shortcut,a=e.description,r=E(),o=r.hotkeys,i=r.selection;return c.a.createElement(o.Hotkey,{shortcut:n,action:function(){i.getRange()&&t(a)},description:a})},me=function(e){var t=Object.assign({},e),n=Object(a.useContext)(g).classes,r=E(),o=r.hotkeys,s=r.selection,l=r.terminal,u=function(e){var t=Object(a.useState)(null),n=Object(i.a)(t,2),c=n[0],r=n[1];return{saveSelection:function(){r(c=e.getRange())},restoreSelection:function(){null!==c&&e.setRange(c)}}}(s),h=u.saveSelection,d=u.restoreSelection,f=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(),o=Object(i.a)(r,2),s=o[0],l=o[1],u=Object(a.useState)(),h=Object(i.a)(u,2),d=h[0],b=h[1],f=Object(a.useState)(!1),p=Object(i.a)(f,2),m=p[0],O=p[1],g=Object(a.useState)(),j=Object(i.a)(g,2),v=j[0],y=j[1],E=Object(a.useState)(),k=Object(i.a)(E,2),w=k[0],x=k[1];return{currentItem:d,hasNext:m,begin:function(e){return new Promise((function(t,a){0!==e.length?(v=t,y((function(){return v})),w=a,x((function(){return w})),c(n=e),O(m=!0),l(s=0),b(d=n[0])):t()}))},moveToNext:function(){if(!m)throw new Error("attempted to iterate past the end of the loop");var e=s+1;if(e>=n.length)return O(m=!1),l(s=e),b(d=null),void v();l(s=e),b(d=n[e])},terminate:function(){O(m=!1),w&&w()}}}(),p=f.currentItem,m=f.hasNext,O=f.begin,j=f.moveToNext,v=f.terminate,y=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1];return{isModalOpen:n,openModal:function(){c(!0)},closeModal:function(){c(!1)}}}(),k=y.isModalOpen,w=y.openModal,x=y.closeModal,C=Object(a.useState)([]),_=Object(i.a)(C,2),S=_[0],N=_[1],L=Object(a.useState)(),R=Object(i.a)(L,2),A=R[0],P=R[1],H=function(e){h(),A=new ue(s.getRange(),e),P(A),O(A.missingProperties).then((function(){A.injectLabel()?l.log("added label:",A.completedLabel):l.log("invalid label:",A.completedLabel),d()})).catch((function(e){console.log(e),P(null),v(),d()}))};return c.a.createElement(b.a,Object.assign({container:!0},t),c.a.createElement(b.a,{item:!0,className:n["c-controls--fill-width"]},c.a.createElement(o.Hotkey,{shortcut:"Enter",action:function(){h(),w()},description:"create custom label"}),c.a.createElement(pe,{shortcut:"c",onLabel:H,description:'dialogue character="?"'}),c.a.createElement(pe,{shortcut:"e",onLabel:H,description:'meta character="?" emotion="?"'}),c.a.createElement("div",{children:S}),c.a.createElement(Q,{open:k,onComplete:function(e){x(),d(),H(e)},onClose:function(){x(),d()},label:"Add label"}),c.a.createElement(Q,{open:m,onComplete:function(e){A.setNextValue(e),j()},onClose:v,label:p}),c.a.createElement(o.CreateNewHotkey,{onHotkeyAdded:function(e,t){var n=c.a.createElement(pe,{key:e,onLabel:H,shortcut:e,description:t});N([n].concat(Object(U.a)(S)))}})))},Oe=function(e){var t=e.children,n=e.value,a=e.index,r=Object(k.a)(e,["children","value","index"]);return c.a.createElement(h.a,Object.assign({component:"div",hidden:n!==a},r),c.a.createElement(V.a,{p:3},t))},ge=function(){var e=Object(a.useContext)(g).classes,t=Object(a.useState)(0),n=Object(i.a)(t,2),r=n[0],o=n[1];return c.a.createElement("div",null,c.a.createElement(l.a,null,c.a.createElement(G.a,{value:r,onChange:function(e,t){o(t)}},c.a.createElement(K.a,{label:"Labels"}),c.a.createElement(K.a,{label:"Files"}))),c.a.createElement(Oe,{className:e.controlTab,value:r,index:0},c.a.createElement(me,null)),c.a.createElement(Oe,{className:e.controlTab,value:r,index:1}))},je=n(49),ve=n.n(je),ye=function(e){var t=e.children,n=Object(k.a)(e,["children"]),a=Ee(t),r=E().terminal,o=document.createElement("div");o.innerHTML=a;var i=o.querySelectorAll("[data-cookiesynth-style]");return 0!==i.length&&r.log("loading existing tags"),i.forEach((function(e){e.setAttribute("style","background-color: yellow;")})),c.a.createElement(L.a,Object.assign({},n,{dangerouslySetInnerHTML:{__html:o.innerHTML}}))},Ee=function(e){return ve()(e,{allowedTags:["h1","h2","h3","h4","h5","h6","hr","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","span","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","iframe"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src"],span:["data-cookiesynth","data-cookiesynth-style"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0})},ke=function(){return c.a.createElement(s.a,{position:"static"},c.a.createElement(l.a,null,c.a.createElement(u.a,{edge:"start",color:"inherit","aria-label":"menu"},c.a.createElement(p.a,null)),c.a.createElement(h.a,{variant:"h6"},"Clipfics")))},we=function(){var e=Object(a.useContext)(g).classes;return c.a.createElement(d.a,{className:e["c-fileio-export-button"],onClick:function(){var e=document.getElementById("js-story-sheet").innerHTML,t=new Blob([e],{type:"text/html"}),n=document.createElement("a");n.setAttribute("href",window.URL.createObjectURL(t)),n.download="cookiesynth - story.html",n.click()}},"Export labels")},xe=function(){var e=Object(a.useState)("Load a story"),t=Object(i.a)(e,2),n=t[0],r=t[1],o={classes:v(j)},s=o.classes,l={};l.hotkeys=new H,l.hotkeys.useHotkeys(),l.storyContainerRef=Object(a.createRef)(),l.selection=new J(l.storyContainerRef),l.terminal=new B,l.terminal.log("hello, anonymous."),l.terminal.log("do you need help using this interface?");var u=l.terminal.Component;return c.a.createElement(g.Provider,{value:o},c.a.createElement("div",{id:"app",className:s["c-app--full-height"]},c.a.createElement(ke,null),c.a.createElement(y.Provider,{value:l},c.a.createElement(b.a,{container:!0,spacing:2},c.a.createElement(b.a,{item:!0,xs:7,className:s["c-story-panel--full-height"]},c.a.createElement("div",{ref:l.storyContainerRef,className:s["c-story-panel__container"]},c.a.createElement(ye,{id:"js-story-sheet",className:s["c-story-panel__paper"]},n))),c.a.createElement(b.a,{item:!0,xs:5,className:s["c-control-panel"]},c.a.createElement(ge,null),c.a.createElement(b.a,{container:!0},c.a.createElement($,{onFileLoaded:function(e){l.terminal.log("loading fic"),r(e)}}),c.a.createElement(we,null))))),c.a.createElement(u,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(xe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[59,1,2]]]);
//# sourceMappingURL=main.0d009af4.chunk.js.map